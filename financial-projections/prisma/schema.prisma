// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model Settings {
  id                    String   @id @default(cuid())
  initialBankBalance    Decimal  @db.Decimal(10, 2)
  initialBalanceDate    DateTime @db.Date  // The date when initial balance is set (typically today on first launch)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

enum EventType {
  EXPENSE
  INCOMING
}

enum CertaintyLevel {
  UNLIKELY
  POSSIBLE
  LIKELY
  CERTAIN
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
  MONTHLY
  ANNUAL
}

model RecurringProjectionEventRule {
  id          String                @id @default(cuid())
  name        String
  description String?
  value       Decimal               @db.Decimal(10, 2)
  type        EventType
  certainty   CertaintyLevel
  payTo       String?               // for expenses
  paidBy      String?               // for incoming

  // Decision path for scenario modeling
  decisionPath String?              // e.g., "take-new-job", "stay-current-role"

  // Recurrence definition
  startDate   DateTime              @db.Date
  endDate     DateTime              @db.Date  // Required to prevent infinite event generation
  frequency   RecurrenceFrequency   @default(MONTHLY)

  // Generated events
  projectionEvents ProjectionEvent[]

  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt

  @@index([decisionPath])
  @@index([startDate])
}

model ProjectionEvent {
  id          String          @id @default(cuid())
  name        String
  description String?
  value       Decimal         @db.Decimal(10, 2)
  type        EventType
  certainty   CertaintyLevel
  payTo       String?         // for expenses
  paidBy      String?         // for incoming
  date        DateTime        @db.Date

  // Decision path for scenario modeling
  decisionPath String?

  // Link to recurring rule (if generated from one)
  recurringRuleId String?
  recurringRule   RecurringProjectionEventRule? @relation(fields: [recurringRuleId], references: [id], onDelete: Cascade)

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([date])
  @@index([decisionPath])
  @@index([recurringRuleId])
}

model DailyBalance {
  id              String   @id @default(cuid())
  date            DateTime @db.Date @unique
  expectedBalance Decimal  @db.Decimal(10, 2)
  actualBalance   Decimal? @db.Decimal(10, 2)  // User can set this
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([date])
}
